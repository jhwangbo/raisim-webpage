

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Articulated Systems &mdash; raisim 0.6.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Single-Body Objects" href="SingleBodyObjects.html" />
    <link rel="prev" title="Objects" href="Object.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> raisim
          

          
          </a>

          
            
            
              <div class="version">
                0.6.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="Installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="ConventionsAndNotations.html">Conventions and Notations</a></li>
<li class="toctree-l1"><a class="reference internal" href="WorldSystem.html">RaiSim World</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="Object.html">Objects</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Articulated Systems</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#creating-an-instance">Creating an instance</a></li>
<li class="toctree-l3"><a class="reference internal" href="#state-representation">State Representation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#joints">Joints</a></li>
<li class="toctree-l3"><a class="reference internal" href="#urdf-convention">URDF convention</a></li>
<li class="toctree-l3"><a class="reference internal" href="#kinematics">Kinematics</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#frames">Frames</a></li>
<li class="toctree-l4"><a class="reference internal" href="#jacobians">Jacobians</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#dynamics">Dynamics</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pd-controller">PD Controller</a></li>
<li class="toctree-l3"><a class="reference internal" href="#integration-steps">Integration Steps</a></li>
<li class="toctree-l3"><a class="reference internal" href="#types-of-indicies">Types of Indicies</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#conversions-between-indicies">Conversions Between Indicies</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="SingleBodyObjects.html">Single-Body Objects</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Contact.html">Contact and Collision</a></li>
<li class="toctree-l1"><a class="reference internal" href="MaterialSystem.html">Material System</a></li>
<li class="toctree-l1"><a class="reference internal" href="Constraints.html">Constraints</a></li>
<li class="toctree-l1"><a class="reference internal" href="RelatedSoftware.html">Related Software</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">raisim</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="Object.html">Objects</a> &raquo;</li>
        
      <li>Articulated Systems</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="articulated-systems">
<h1>Articulated Systems<a class="headerlink" href="#articulated-systems" title="Permalink to this headline">¶</a></h1>
<p>Articulated Systems are a system of multiple bodies connected through joints.
There are two types of articulated systems: <em>Kinematic trees</em> and <em>closed-loop systems</em>.
Kinematic trees do not contain a loop (a body always has only one parent joint).
Consequently, the number of joints is equal to the number of bodies (for floating systems, we assign a floating joint on the root body).
RaiSim can only simulate <strong>kinematic trees</strong>.</p>
<div class="section" id="creating-an-instance">
<h2>Creating an instance<a class="headerlink" href="#creating-an-instance" title="Permalink to this headline">¶</a></h2>
<p>Just like any other object, an articulated system is created by the world instance using <code class="code docutils literal notranslate"><span class="pre">addArticulatedSystem</span></code> method.
There are tree ways to specify the system.</p>
<ol class="arabic simple">
<li><p>by providing the path to the URDF file (the most recommneded way)</p></li>
<li><p>by providing <code class="code docutils literal notranslate"><span class="pre">std::string</span></code> of the URDF text (can be useful when working with Xacro)</p></li>
<li><p>by providing a <code class="code docutils literal notranslate"><span class="pre">raisim::Child</span></code> instance. It is an advanced method and not recommnded to beginners.</p></li>
</ol>
<p>Note that option 1 and 2 use the same method. You can provide either the path string or the contents string and the class will identify which one is provided.</p>
</div>
<div class="section" id="state-representation">
<h2>State Representation<a class="headerlink" href="#state-representation" title="Permalink to this headline">¶</a></h2>
<p>The state of an articulated system can be represented by a <strong>generalized state</strong> <span class="math notranslate nohighlight">\(\boldsymbol{S}\)</span>, which is composed of a <strong>generalized coordinate</strong> <span class="math notranslate nohighlight">\(\boldsymbol{q}\)</span> and a <strong>generalized velocity</strong> <span class="math notranslate nohighlight">\(\boldsymbol{u}\)</span>.
Since we are not constraining their parameterization, in general,</p>
<div class="math notranslate nohighlight">
\[\begin{equation}
  \boldsymbol{u}\neq\dot{\boldsymbol{q}}.
\end{equation}\]</div>
<p>A generalized coordinate fully represents the configuration of the articulated system and a generalized velocity fully represents the velocity state of the articulated system.</p>
<p>Both Generalized coordinate and velocity are defined by what joints link the bodies together.
Each joint has a generalized coordinate and a generalized velocity.
Stack of all joint generalized coordinates and velocities are the generalized coordinates and velocities of the articulated system, respectively.
The order of stacking is called <strong>joint order</strong>.
The joint order is the order the joint appears in the URDF unless otherwise it is explicitly given at the construction time.
The joint order can be accessed through <code class="code docutils literal notranslate"><span class="pre">getMovableJointNames()</span></code>.
Note the keyword “movable”.
The fixed joints contribute to neither the generalized coordinate nor the generalized velocity.
Only movable the joints do.
The joint order starts with a <strong>root body</strong> which is the first body of the articulated system.
For floating-base systems, a root body is the floating base.
For fixed-base systems, a root body is the one rigidly attached to the wolrd (and thus cannot move).
The following example illustrates how the generalized coordinates and velocities are defined.</p>
<p><strong>image here</strong></p>
<p>To set the state of the system, the following methods can be used</p>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">setGeneralizedCoordinate</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">setGeneralizedVelocity</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">setState</span></code></p></li>
</ul>
<p>To obtain the state of the system, the following methods can be used</p>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">getGeneralizedCoordinate</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">getGeneralizedVelocity</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">getState</span></code></p></li>
</ul>
<p>The dimensions of each vector can be obtained respectively by</p>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">getGeneralizedCoordinateDim</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">getDOF</span></code> or <code class="code docutils literal notranslate"><span class="pre">getGeneralizedVelocityDim</span></code>. These two methods are identical</p></li>
</ul>
</div>
<div class="section" id="joints">
<h2>Joints<a class="headerlink" href="#joints" title="Permalink to this headline">¶</a></h2>
<p>Here are the available joints in RaiSim.</p>
<table class="colwidths-given docutils align-default" id="id1">
<caption><span class="caption-text">Joint Properties (<span class="math notranslate nohighlight">\(|\cdot|\)</span> is a symbol for dimension size (i.e., cardinality))</span><a class="headerlink" href="#id1" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 18%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"></th>
<th class="head"><p>Fixed</p></th>
<th class="head"><p>Floating</p></th>
<th class="head"><p>Revolute</p></th>
<th class="head"><p>Prismatic</p></th>
<th class="head"><p>Spherical</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(|\boldsymbol{u}|\)</span></p></td>
<td><p>0</p></td>
<td><p>6</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
<td><p>3</p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(|\boldsymbol{q}|\)</span></p></td>
<td><p>0</p></td>
<td><p>7</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-even"><td><p>Velocity</p></td>
<td></td>
<td><p><span class="math notranslate nohighlight">\(m/s\)</span>, <span class="math notranslate nohighlight">\(rad/s\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(rad/s\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(m/s\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(rad/s\)</span></p></td>
</tr>
<tr class="row-odd"><td><p>Position</p></td>
<td></td>
<td><p><span class="math notranslate nohighlight">\(m\)</span>, <span class="math notranslate nohighlight">\(rad\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(rad\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(m\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(rad\)</span></p></td>
</tr>
<tr class="row-even"><td><p>Force</p></td>
<td></td>
<td><p><span class="math notranslate nohighlight">\(N\)</span>, <span class="math notranslate nohighlight">\(Nm\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(Nm\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(N\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(Nm\)</span></p></td>
</tr>
</tbody>
</table>
<p>The generalized coordinates/velocities of a joint are expressed in the <strong>joint frame</strong> and with respect to the <strong>parent body</strong>.
Joint frame is the frame attached to every joint and fixed to the parent body.
Parent body is the one closer to the root body among the two bodies connected via the joint.
Note that the angular velocity of a floating base is also expressed in the parent frame (which is the <strong>world frame</strong>).
Other libraries (e.g., RBLD) might have a different convention and a special care has to be taken in conversions.</p>
</div>
<div class="section" id="urdf-convention">
<h2>URDF convention<a class="headerlink" href="#urdf-convention" title="Permalink to this headline">¶</a></h2>
<p>RaiSim uses a modified URDF protocol to define an articulated system.
URDF files following the original convention can be read in RaiSim.
However, since RaiSim offers more functionalities, a RaiSim URDF might not be read by other libraries following the original URDF convention.</p>
<p>The modifications are as follows:</p>
<ul class="simple">
<li><p>Capsule geom is available for both collision objects and visual objects (with the keyword “capsule”). The geom is defined by “height” and “radius” keyword. The height represents the distance between the two center points of the spheres.</p></li>
<li><p>A &lt;joint&gt;/&lt;dynamics&gt; tag can have three more attributes: <em>rotor inertia</em>, <em>spring_mount</em> and <em>stiffness</em>.</p></li>
</ul>
<p><strong>Rotor inertia</strong> in Raisim approximately simulates the rotor inertia of the motor (but missing the resulting gyroscopic effect, which is often neglegible).
It is added to the diagonal elements of the mass matrix.
It is common way to include the inertial effect of the rotor.
This means that it only
You can also override it in C++ using <code class="code docutils literal notranslate"><span class="pre">setRotorInertia()</span></code>.</p>
<p>In RaiSim, each body of an articulated system has a set of collision bodies and visual objects.</p>
<p>Collision bodies contain a collision object of one of the following shapes: <em>mesh</em>, <em>sphere</em>, <em>box</em>, <em>cylinder</em>, <em>capsule</em>.</p>
<p>Visual objects just store specifications for visualization and the actual visualzation happens in a visualizer (e.g., <a class="reference external" href="https://github.com/leggedrobotics/raisimOgre">raisimOgre</a>)</p>
<p>For details, check the <a class="reference external" href="http://wiki.ros.org/urdf/XML">URDF protocol</a>.</p>
</div>
<div class="section" id="kinematics">
<h2>Kinematics<a class="headerlink" href="#kinematics" title="Permalink to this headline">¶</a></h2>
<div class="section" id="frames">
<h3>Frames<a class="headerlink" href="#frames" title="Permalink to this headline">¶</a></h3>
<p>A position and velocity of a specific point on a body of an articulated system can be obtained by attaching a <strong>frame</strong>.
<strong>Frame</strong> of an articulated system in RaiSim is rigidly attached to a body of the system and has a constant position and orientation (w.r.t. parent frame).
It is the most recommended way to get kinematics information of a point of an articulated system in RaiSim.</p>
<p>All joint frames have a frame attached and their names are the same as the joint name.
To create a custom frame, a fixed frame can be defined at the point of the interest.
A dummy link with zero inertia and zero mass can be added on one side of the fixed joint to complete the kinematic tree.</p>
<p>A frame can be locally stored as an index in the user code. For e.g.,</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">“raisim/World.hpp”</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">raisim</span><span class="o">::</span><span class="n">World</span> <span class="n">world</span><span class="p">;</span>
  <span class="k">auto</span> <span class="n">anymal</span> <span class="o">=</span> <span class="n">world</span><span class="p">.</span><span class="n">addArticulatedSystem</span><span class="p">(</span><span class="n">PATH_TO_URDF</span><span class="p">);</span>
  <span class="k">auto</span> <span class="n">footFrameIndex</span> <span class="o">=</span> <span class="n">world</span><span class="p">.</span><span class="n">getFrameIdxByName</span><span class="p">(</span><span class="s">&quot;foot_joint&quot;</span><span class="p">);</span> <span class="c1">// the URDF has a joint named &quot;foot_joint&quot;</span>
  <span class="n">raisim</span><span class="o">::</span><span class="n">Vec</span><span class="o">&lt;</span><span class="mi">3</span><span class="o">&gt;</span> <span class="n">footPosition</span><span class="p">,</span> <span class="n">footVelocity</span><span class="p">,</span> <span class="n">footAngularVelocity</span><span class="p">;</span>
  <span class="n">raisim</span><span class="o">::</span><span class="n">Mat</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="o">&gt;</span> <span class="n">footOrientation</span><span class="p">;</span>
  <span class="n">world</span><span class="p">.</span><span class="n">getFramePosition</span><span class="p">(</span><span class="n">footFrameIndex</span><span class="p">,</span> <span class="n">footPosition</span><span class="p">);</span>
  <span class="n">world</span><span class="p">.</span><span class="n">getFrameOrientation</span><span class="p">(</span><span class="n">footFrameIndex</span><span class="p">,</span> <span class="n">footOrientation</span><span class="p">);</span>
  <span class="n">world</span><span class="p">.</span><span class="n">getFrameVelocity</span><span class="p">(</span><span class="n">footFrameIndex</span><span class="p">,</span> <span class="n">footVelocity</span><span class="p">);</span>
  <span class="n">world</span><span class="p">.</span><span class="n">getFrameAngularVelocity</span><span class="p">(</span><span class="n">footFrameIndex</span><span class="p">,</span> <span class="n">footAngularVelocity</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>You can also store Frame reference.
For e.g., you can replace <code class="code docutils literal notranslate"><span class="pre">getFrameIdxByName</span></code> by <code class="code docutils literal notranslate"><span class="pre">getFrameByName</span></code> in the above example.
In this way, you can access the internal variables and even modify them.
Modifying the frames do not affect the joints.
Frames are instantiated during initialization of the articulated system instance and affect neither kinematics nor dynamics of the system.</p>
</div>
<div class="section" id="jacobians">
<h3>Jacobians<a class="headerlink" href="#jacobians" title="Permalink to this headline">¶</a></h3>
<p>Jacobians of a point in RaiSim satisfy the following equation:</p>
<div class="math notranslate nohighlight">
\[\begin{equation}
  \boldsymbol{J}\boldsymbol{u} = \boldsymbol{v}
\end{equation}\]</div>
<p>where <span class="math notranslate nohighlight">\(\boldsymbol{v}\)</span> represents the linear velocity of the associated point.
If a rotational Jacobian is used, the right-hand side changes to a rotational velocity expressed in the world frame.</p>
<p>To get the Jacobians associated with the linear velocity, the following methods are used</p>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">getSparseJacobian</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">getDenseJacobian</span></code> – this method only fills non-zero values. The matrix should be initialized to a zero matrix of an appropriate size.</p></li>
</ul>
<p>To get the rotational Jacobians, the following methods are used</p>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">getSparseRotationalJacobian</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">getDenseRotationalJacobian</span></code> – this method only fills non-zero values. The matrix should be initialized to a zero matrix of an appropriate size.</p></li>
</ul>
<p>The main Jacobian class in RaiSim is <code class="code docutils literal notranslate"><span class="pre">raisim::SparseJacobian</span></code>.
It has a member <code class="code docutils literal notranslate"><span class="pre">idx</span></code> which stores the indicies of columns whose values are non-zero.
Note that only the joints between the child body and the root body affect the motion of the point.</p>
</div>
</div>
<div class="section" id="dynamics">
<h2>Dynamics<a class="headerlink" href="#dynamics" title="Permalink to this headline">¶</a></h2>
<p>All force and torque acting on the system can be represented as a single vector in the generalized velocity space.
This representation is called <strong>generalized force</strong> <span class="math notranslate nohighlight">\(\boldsymbol{\tau}\)</span>.
Just like in a Cartesian coordiate (i.e., x, y, z axes), the power exerted by an articulated system is computed as a dot product of generalized force and generalized velocity (i.e., <span class="math notranslate nohighlight">\(\boldsymbol{u}\cdot\boldsymbol{\tau}\)</span>).</p>
<p>We can also combine the mass and inertia of the whole articulated system and represent them in a single matrix.
This matrix is called <strong>mass matrix</strong> or <strong>inertia matrix</strong> and denoted by <span class="math notranslate nohighlight">\(\boldsymbol{M}\)</span>.
A mass matrix represents how much the articulated system resists change in generalized velocities.
Naively speaking, a large mass matrix means that the articulated system gets low velocity change for a given generalized force.</p>
<p>The total kinetic energy of the system is computed as <span class="math notranslate nohighlight">\(\frac{1}{2}\boldsymbol{u}^T\boldsymbol{M}\boldsymbol{u}\)</span>.
This quantity can be obtained by <code class="code docutils literal notranslate"><span class="pre">getKineticEnergy()</span></code>.</p>
<p>The total potential energy due to the gravity is a sum of <span class="math notranslate nohighlight">\(mgh\)</span> for all bodies.
This quantity can be obtained by <code class="code docutils literal notranslate"><span class="pre">getEnergy()</span></code>.
Note that the gravity has to be specified since only the world has the gravity vector.</p>
<p>The equation of motion of an articulated system is shown below:</p>
<div class="math notranslate nohighlight">
\[\begin{equation}
   \boldsymbol{\tau} = \boldsymbol{M}(\boldsymbol{q})\dot{\boldsymbol{u}} + \boldsymbol{h}(\boldsymbol{q}, \boldsymbol{u}).
\end{equation}\]</div>
<p>Here <span class="math notranslate nohighlight">\(\boldsymbol{h}\)</span> is called a <strong>non-linear term</strong>.
There are three sources of force that contributes to the non-linear term: gravity, coriolis, and centrifugal force.</p>
<p>The following methods are used to obtain dynamic quantities</p>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">getMassMatrix()</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">getNonlinearities()</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">getInverseMassMatrix()</span></code></p></li>
</ul>
<p>It is rarely useful to compute the gravity contribution to the nonlinear term alone.
However, if it is needed, the easiest way is to make the same robot in another world with zero velocity.
If the generalized velocity is zero, the coriolis and centrifugal contributions are zero.</p>
</div>
<div class="section" id="pd-controller">
<h2>PD Controller<a class="headerlink" href="#pd-controller" title="Permalink to this headline">¶</a></h2>
<p>When naively implemented, a PD controller can often make a robot unstable.
For simulating a discrete control system (e.g., robot), this instability is also present in the real system.
However, it is often desirable to have a stable PD controller when a user wants to keep the time step small.</p>
<p>To use the PD controller, the control mode has to be set to the “PD_PLUS_FEEDFORWARD_TORQUE” mode as following</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">robot</span><span class="o">-&gt;</span><span class="n">setControlMode</span><span class="p">(</span><span class="n">ControlMode</span><span class="o">::</span><span class="n">Type</span><span class="o">::</span><span class="n">PD_PLUS_FEEDFORWARD_TORQUE</span><span class="p">);</span>
</pre></div>
</div>
<p>The current control mode can be retrived as below</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">auto</span> <span class="n">controlMode</span> <span class="o">=</span> <span class="n">robot</span><span class="o">-&gt;</span><span class="n">getControlMode</span><span class="p">();</span>
</pre></div>
</div>
<p>Next, the desirable joint gains have to be set.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">Eigen</span><span class="o">::</span><span class="n">VectorXd</span> <span class="n">pGain</span><span class="p">(</span><span class="n">robot</span><span class="o">-&gt;</span><span class="n">getDOF</span><span class="p">()),</span> <span class="n">dGain</span><span class="p">(</span><span class="n">robot</span><span class="o">-&gt;</span><span class="n">getDOF</span><span class="p">());</span>
<span class="n">pGain</span><span class="o">&lt;&lt;</span> <span class="p">...;</span> <span class="c1">// set your proportional gain values here</span>
<span class="n">dGain</span><span class="o">&lt;&lt;</span> <span class="p">...;</span> <span class="c1">// set your differential gain values here</span>
<span class="n">robot</span><span class="o">-&gt;</span><span class="n">setPdGains</span><span class="p">(</span><span class="n">pGain</span><span class="p">,</span> <span class="n">dGain</span><span class="p">);</span>
</pre></div>
</div>
<p>Note that <strong>the dimension of the pGain vector is the same as that of the generalized velocity NOT that of the coordinate</strong>.</p>
<p>Finally, the target position and the velocity can set as below</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">Eigen</span><span class="o">::</span><span class="n">VectorXd</span> <span class="n">pTarget</span><span class="p">(</span><span class="n">robot</span><span class="o">-&gt;</span><span class="n">getGeneralizedCoordinateDim</span><span class="p">()),</span> <span class="n">vTarget</span><span class="p">(</span><span class="n">robot</span><span class="o">-&gt;</span><span class="n">getDOF</span><span class="p">());</span>
<span class="n">pTarget</span><span class="o">&lt;&lt;</span> <span class="p">...;</span> <span class="c1">// set your position target</span>
<span class="n">vTarget</span><span class="o">&lt;&lt;</span> <span class="p">...;</span> <span class="c1">// set your velocity target</span>
<span class="n">robot</span><span class="o">-&gt;</span><span class="n">setPdTarget</span><span class="p">(</span><span class="n">pTarget</span><span class="p">,</span> <span class="n">vTarget</span><span class="p">);</span>
</pre></div>
</div>
<p>Here, <strong>the dimension of the pTarget vector is the same as that of the generalized coordinate NOT that of the velocity</strong>.
This is confusing and might seem inconsistent.
However, this is a valid convention.
The only reason that the two dimensions differ is a quaternion.
The quaternion target is represented by a quaternion whereas the virtual spring stiffness between the two orientations can be represented by a 3D vector, which is composed of motions in each angular velocity components.</p>
<p>A feedforward force term can be added by <code class="code docutils literal notranslate"><span class="pre">setGeneralizedForce()</span></code>.
Note that this value stored at the instance and does not change unless the user specifies it to.
If this feedforward force should be applied for a single time step, it should be set to zero in the subsequent control loop (after <code class="code docutils literal notranslate"><span class="pre">integrate()</span></code> call of the world).</p>
<p>The theory of the implemented PD controller can be found in chapter 1.2 of this <a class="reference external" href="https://www.overleaf.com/read/dbqbgcnhzykq">article</a>.
This document is only for advanced users and it is not necessary to use RaiSim.</p>
</div>
<div class="section" id="integration-steps">
<h2>Integration Steps<a class="headerlink" href="#integration-steps" title="Permalink to this headline">¶</a></h2>
<p>Integration of an articulated systems is performed in two stages: <code class="code docutils literal notranslate"><span class="pre">integrate1</span></code> and <code class="code docutils literal notranslate"><span class="pre">integrate2</span></code></p>
<p>The following steps are performed in <code class="code docutils literal notranslate"><span class="pre">integrate1</span></code></p>
<ol class="arabic simple">
<li><p>If the time step changed, update the damping of the mass matrix (which reflects effective inertial increase due to springs, dampers and PD gains)</p></li>
<li><p>Update positions of the collision bodies</p></li>
<li><p>Detect collisions (called by the world instance)</p></li>
<li><p>The world assigns contacts on each object and computes the contact normal</p></li>
<li><p>Compute the mass matrix, nonlinear term and inverse inertia matrix</p></li>
</ol>
<p>After this step, all kinematic/dynamic proerpties are computed at this stage.
Users can access them if they are necessary for the controller.
Next, <code class="code docutils literal notranslate"><span class="pre">integrate2</span></code> computes the contact forces and integrate the velocities and positions.</p>
<ol class="arabic simple" start="6">
<li><p>Compute jacobians of contacts</p></li>
<li><p>Compute contact Properties</p></li>
<li><p>Compute PD controller (if used), add it to the feedforward force and bound it by the limits</p></li>
<li><p>Compute generalized forces due to springs and external forces/torques</p></li>
<li><p>Contact solver (called by the world instance)</p></li>
<li><p>Integrate the velocity</p></li>
<li><p>Integrate the position (in a semi-implicit way)</p></li>
</ol>
</div>
<div class="section" id="types-of-indicies">
<h2>Types of Indicies<a class="headerlink" href="#types-of-indicies" title="Permalink to this headline">¶</a></h2>
<p>ArticulatedSystem class contains multiple types of indicies. To query a specific quantity, you have to provide an index of the right type. Here are the types of indicies in Articulated Systems</p>
<ul class="simple">
<li><p><strong>Body/Joint Index</strong>: All fixed bodies are combined to a single movable body. Each movable body has a unique body index. Because there is a movable joint associated with a movable body, there is a 1-to-1 mapping between the joints and the bodies and they share the same index. For a fixed-base system, the first body rigidly fixed to the world is body-0. For a floating-base system, the floating base is body-0.</p></li>
<li><p><strong>Generalized Velocity (DOF) Index</strong>: All joints are mapped to a specific set of generalized velocity indicies.</p></li>
<li><p><strong>Generalized Coordinate Index</strong>:</p></li>
<li><p><strong>Frame Index</strong>:</p></li>
</ul>
<div class="section" id="conversions-between-indicies">
<h3>Conversions Between Indicies<a class="headerlink" href="#conversions-between-indicies" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>A body index to a generalized velocity index: <code class="code docutils literal notranslate"><span class="pre">ArticulatedSystem::getMappingFromBodyIndexToGeneralizedVelocityIndex()</span></code></p></li>
<li><p>A body index to a generalized coordinate index: <code class="code docutils literal notranslate"><span class="pre">ArticulatedSystem::getMappingFromBodyIndexToGeneralizedCoordinateIndex()</span></code></p></li>
</ul>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="SingleBodyObjects.html" class="btn btn-neutral float-right" title="Single-Body Objects" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Object.html" class="btn btn-neutral float-left" title="Objects" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Jemin Hwangbo

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>